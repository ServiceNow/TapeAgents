
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="TapeAgents is a framework that facilitates all stages of the LLM Agent development lifecycle">
      
      
      
        <link rel="canonical" href="https://servicenow.github.io/TapeAgents/reference/agent/">
      
      
        <link rel="prev" href="../../quickstart/">
      
      
        <link rel="next" href="../batch/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.46">
    
    
      
        <title>Agent - TapeAgents Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tapeagents.agent" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TapeAgents Documentation" class="md-header__button md-logo" aria-label="TapeAgents Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TapeAgents Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Agent
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ServiceNow/TapeAgents" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ServiceNow/TapeAgents
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../quickstart/" class="md-tabs__link">
        
  
    
  
  Quickstart

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TapeAgents Documentation" class="md-nav__button md-logo" aria-label="TapeAgents Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    TapeAgents Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ServiceNow/TapeAgents" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ServiceNow/TapeAgents
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Agent
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Agent
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.full_name" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;full_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.llm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;llm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.manager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.template" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.clone" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clone
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.compute_view" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;compute_view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.create" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.delegate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;delegate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.find_node" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;find_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.find_subagent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;find_subagent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.generate_steps" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.get_node_runs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_node_runs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.get_subagent_names" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subagent_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.is_agent_step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;is_agent_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.make_llm_output" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_llm_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.make_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_prompt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.make_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_training_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.make_training_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_training_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.reuse" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;reuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.run_iteration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run_iteration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.select_node" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.should_stop" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;should_stop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.update" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.AgentStream" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AgentStream
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AgentStream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.AgentStream.get_final_tape" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_final_tape
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.AgentStream.get_steps" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.Annotator" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Annotator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.Node" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Node
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Node.generate_steps" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Node.make_llm_output" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_llm_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Node.make_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_prompt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.TapeReuseFailure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TapeReuseFailure
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Batch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../demo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dialog_tape/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dialog Tape
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../finetune/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Finetune
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Finetune
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/checkpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Checkpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/context/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Context
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/eval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eval
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/finetune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Finetune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/logging_/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/lora/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/optim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../finetune/rl/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    RL
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_8_9" id="__nav_3_8_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_8_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8_9">
            <span class="md-nav__icon md-icon"></span>
            RL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/rl/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetune/types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Types
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../llm_function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LLM Function
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../llms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LLMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Observe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../orchestrator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Orchestrator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parallel_processing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallel Processing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prompting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prompting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_17" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../renderers/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Renderers
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_17" id="__nav_3_17_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_17">
            <span class="md-nav__icon md-icon"></span>
            Renderers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../renderers/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../renderers/camera_ready_renderer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Camera Ready Renderer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../renderers/pretty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pretty
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../studio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Studio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tape_browser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tape Browser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../team/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Team
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_21" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_21" id="__nav_3_21_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_21">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/calculator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calculator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/container_executor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Container Executor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/document_converters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Document Converters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/gym_browser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gym Browser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/python_interpreter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python Interpreter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/simple_browser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple Browser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/stock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stock
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../view/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    View
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.full_name" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;full_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.llm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;llm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.manager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.template" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.clone" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clone
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.compute_view" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;compute_view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.create" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.delegate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;delegate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.find_node" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;find_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.find_subagent" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;find_subagent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.generate_steps" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.get_node_runs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_node_runs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.get_subagent_names" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subagent_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.is_agent_step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;is_agent_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.make_llm_output" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_llm_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.make_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_prompt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.make_training_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_training_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.make_training_text" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_training_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.reuse" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;reuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.run_iteration" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run_iteration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.select_node" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.should_stop" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;should_stop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Agent.update" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.AgentStream" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AgentStream
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AgentStream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.AgentStream.get_final_tape" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_final_tape
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.AgentStream.get_steps" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.Annotator" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Annotator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.Node" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Node
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Node.generate_steps" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Node.make_llm_output" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_llm_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tapeagents.agent.Node.make_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_prompt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tapeagents.agent.TapeReuseFailure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TapeReuseFailure
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Agent</h1>

<div class="doc doc-object doc-module">



<a id="tapeagents.agent"></a>
    <div class="doc doc-contents first">

        <p>Base classes for agents and nodes.</p>







<p><span class="doc-section-title">Classes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent" href="#tapeagents.agent.Agent">Agent</a></code></b>
          –
          <div class="doc-md-description">
            <p>Base class for agents within the TapeAgents framework.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.AgentStream" href="#tapeagents.agent.AgentStream">AgentStream</a></code></b>
          –
          <div class="doc-md-description">
            <p>A wrapper around a generator that produces AgentEvents, representing the result of an agent run.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Annotator" href="#tapeagents.agent.Annotator">Annotator</a></code></b>
          –
          <div class="doc-md-description">
            <p>Annotator is the base class for agents that produce annotations for the tape of another agent.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Node" href="#tapeagents.agent.Node">Node</a></code></b>
          –
          <div class="doc-md-description">
            <p>A node in the agent, atomic unit of the agent's behavior.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.TapeReuseFailure" href="#tapeagents.agent.TapeReuseFailure">TapeReuseFailure</a></code></b>
          –
          <div class="doc-md-description">
            <p>Exception raised when tape reuse operation fails.</p>
          </div>
        </li>
    </ul>







  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tapeagents.agent.Agent" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>Agent</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code>, <code><span title="typing.Generic">Generic</span>[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>]</code></p>


        <p>Base class for agents within the TapeAgents framework.</p>
<p>An agent is a model that can run on a tape, generating new steps based on the tape's state.
The agent can have subagents, which are other agents that it manages and can delegate to.
The agent can also have nodes, which are atomic units of the agent's behavior that it can choose to run based on the tape.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.Agent.name">name</span></code></b>
              (<code>str</code>)
          –
          <div class="doc-md-description">
            <p>The unique name of the agent.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.Agent.llms">llms</span></code></b>
              (<code>dict[str, <span title="pydantic.SerializeAsAny">SerializeAsAny</span>[<a class="autorefs autorefs-internal" title="tapeagents.llms.LLM" href="../llms/#tapeagents.llms.LLM">LLM</a>]]</code>)
          –
          <div class="doc-md-description">
            <p>A dictionary mapping names to LLM instances used by the agent.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.Agent.subagents">subagents</span></code></b>
              (<code>list[<span title="typing.Any">Any</span>]</code>)
          –
          <div class="doc-md-description">
            <p>A list of subagents managed by this agent. Subagents must have unique names.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.Agent.templates">templates</span></code></b>
              (<code>dict[str, <span title="typing.Any">Any</span>]</code>)
          –
          <div class="doc-md-description">
            <p>A dictionary of templates used for generating prompts.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.Agent.nodes">nodes</span></code></b>
              (<code>list[<span title="pydantic.SerializeAsAny">SerializeAsAny</span>[<a class="autorefs autorefs-internal" title="tapeagents.agent.Node" href="#tapeagents.agent.Node">Node</a>]]</code>)
          –
          <div class="doc-md-description">
            <p>A list of nodes that define the agent's actions and decision points.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.Agent.max_iterations">max_iterations</span></code></b>
              (<code>int</code>)
          –
          <div class="doc-md-description">
            <p>The maximum number of iterations the agent will execute before stopping.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.manager" href="#tapeagents.agent.Agent.manager">manager</a></code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent" href="#tapeagents.agent.Agent">Agent</a></code>)
          –
          <div class="doc-md-description">
            <p>Retrieves the manager agent overseeing this agent.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.llm" href="#tapeagents.agent.Agent.llm">llm</a></code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.llms.LLM" href="../llms/#tapeagents.llms.LLM">LLM</a></code>)
          –
          <div class="doc-md-description">
            <p>Default language model if only one is configured.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.template" href="#tapeagents.agent.Agent.template">template</a></code></b>
              (<code>Template</code>)
          –
          <div class="doc-md-description">
            <p>Default template if only one is configured.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.full_name" href="#tapeagents.agent.Agent.full_name">full_name</a></code></b>
              (<code>str</code>)
          –
          <div class="doc-md-description">
            <p>Hierarchical name of the agent, including its manager hierarchy.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If configuration inconsistencies are detected:</p>
<ul>
<li>If a subagent is already managed by another agent</li>
<li>If any subagent is not an instance of Agent class</li>
<li>If there are duplicate names among subagents</li>
<li>If there are duplicate names among nodes</li>
</ul>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.clone" href="#tapeagents.agent.Agent.clone">clone</a></code></b>
            –
            <div class="doc-md-description">
              <p>Creates a deep copy of the current agent instance.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.compute_view" href="#tapeagents.agent.Agent.compute_view">compute_view</a></code></b>
            –
            <div class="doc-md-description">
              <p>Compute the view stack from a given tape.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.create" href="#tapeagents.agent.Agent.create">create</a></code></b>
            –
            <div class="doc-md-description">
              <p>Creates an instance of the class with provided LLMs and templates.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.delegate" href="#tapeagents.agent.Agent.delegate">delegate</a></code></b>
            –
            <div class="doc-md-description">
              <p>Delegates control to the appropriate subagent based on the current tape state.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.find_node" href="#tapeagents.agent.Agent.find_node">find_node</a></code></b>
            –
            <div class="doc-md-description">
              <p>Find a node by its name in the list of nodes.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.find_subagent" href="#tapeagents.agent.Agent.find_subagent">find_subagent</a></code></b>
            –
            <div class="doc-md-description">
              <p>Find a subagent by name in the list of subagents.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.generate_steps" href="#tapeagents.agent.Agent.generate_steps">generate_steps</a></code></b>
            –
            <div class="doc-md-description">
              <p>Generate steps from the agent by selecting a node and processing its output.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.get_node_runs" href="#tapeagents.agent.Agent.get_node_runs">get_node_runs</a></code></b>
            –
            <div class="doc-md-description">
              <p>Parse the tape and identify the indices where each node began its execution.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.get_subagent_names" href="#tapeagents.agent.Agent.get_subagent_names">get_subagent_names</a></code></b>
            –
            <div class="doc-md-description">
              <p>Returns a list of names of all subagents.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.is_agent_step" href="#tapeagents.agent.Agent.is_agent_step">is_agent_step</a></code></b>
            –
            <div class="doc-md-description">
              <p>Check if a step was produced by the agent.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.make_llm_output" href="#tapeagents.agent.Agent.make_llm_output">make_llm_output</a></code></b>
            –
            <div class="doc-md-description">
              <p>Generates an LLM output based on a tape and step index.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.make_prompt" href="#tapeagents.agent.Agent.make_prompt">make_prompt</a></code></b>
            –
            <div class="doc-md-description">
              <p>Makes the prompt for the next iteration of the agent.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.make_training_data" href="#tapeagents.agent.Agent.make_training_data">make_training_data</a></code></b>
            –
            <div class="doc-md-description">
              <p>Generates training data from a tape by converting LLM calls into training texts.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.make_training_text" href="#tapeagents.agent.Agent.make_training_text">make_training_text</a></code></b>
            –
            <div class="doc-md-description">
              <p>Routes the request to make training text to the agent's LLM.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.reuse" href="#tapeagents.agent.Agent.reuse">reuse</a></code></b>
            –
            <div class="doc-md-description">
              <p>Reuse another agent's tape as one's own.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.run" href="#tapeagents.agent.Agent.run">run</a></code></b>
            –
            <div class="doc-md-description">
              <p>Run the agent on the tape iteratively, delegating to subagents until a stop condition is met.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.run_iteration" href="#tapeagents.agent.Agent.run_iteration">run_iteration</a></code></b>
            –
            <div class="doc-md-description">
              <p>Run one iteration of the agent (assuming one call to the underlyng model).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.select_node" href="#tapeagents.agent.Agent.select_node">select_node</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the next node to execute based on the current state of the tape.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.should_stop" href="#tapeagents.agent.Agent.should_stop">should_stop</a></code></b>
            –
            <div class="doc-md-description">
              <p>Check if the agent should stop its turn and wait for observations.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.update" href="#tapeagents.agent.Agent.update">update</a></code></b>
            –
            <div class="doc-md-description">
              <p>Updates the agent's configuration while preserving instance types.</p>
            </div>
          </li>
    </ul>




<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.full_name" href="#tapeagents.agent.Agent.full_name">full_name</a></code></b>
          –
          <div class="doc-md-description">
            <p>Returns the full hierarchical name of the agent.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.llm" href="#tapeagents.agent.Agent.llm">llm</a></code></b>
          –
          <div class="doc-md-description">
            <p>Get the default LLM instance associated with the agent.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.manager" href="#tapeagents.agent.Agent.manager">manager</a></code></b>
          –
          <div class="doc-md-description">
            <p>Gets the manager of the agent.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent.template" href="#tapeagents.agent.Agent.template">template</a></code></b>
          –
          <div class="doc-md-description">
            <p>Returns the default template of the agent.</p>
          </div>
        </li>
    </ul>

              <details class="quote">
                <summary>Source code in <code>tapeagents/agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for agents within the TapeAgents framework.</span>

<span class="sd">    An agent is a model that can run on a tape, generating new steps based on the tape&#39;s state.</span>
<span class="sd">    The agent can have subagents, which are other agents that it manages and can delegate to.</span>
<span class="sd">    The agent can also have nodes, which are atomic units of the agent&#39;s behavior that it can choose to run based on the tape.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): The unique name of the agent.</span>
<span class="sd">        llms (dict[str, SerializeAsAny[LLM]]): A dictionary mapping names to LLM instances used by the agent.</span>
<span class="sd">        subagents (list[Any]): A list of subagents managed by this agent. Subagents must have unique names.</span>
<span class="sd">        templates (dict[str, Any]): A dictionary of templates used for generating prompts.</span>
<span class="sd">        nodes (list[SerializeAsAny[Node]]): A list of nodes that define the agent&#39;s actions and decision points.</span>
<span class="sd">        max_iterations (int): The maximum number of iterations the agent will execute before stopping.</span>
<span class="sd">        manager (Agent): Retrieves the manager agent overseeing this agent.</span>
<span class="sd">        llm (LLM): Default language model if only one is configured.</span>
<span class="sd">        template (Template): Default template if only one is configured.</span>
<span class="sd">        full_name (str): Hierarchical name of the agent, including its manager hierarchy.</span>


<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If configuration inconsistencies are detected:</span>

<span class="sd">            - If a subagent is already managed by another agent</span>
<span class="sd">            - If any subagent is not an instance of Agent class</span>
<span class="sd">            - If there are duplicate names among subagents</span>
<span class="sd">            - If there are duplicate names among nodes</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">llms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SerializeAsAny</span><span class="p">[</span><span class="n">LLM</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># can&#39;t use list[Agent] because of pydantic bug</span>
    <span class="c1"># https://github.com/pydantic/pydantic/issues/9969</span>
    <span class="n">subagents</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List of subagents, which are agents that are run by this agent. Subagents must have unique names.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">templates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SerializeAsAny</span><span class="p">[</span><span class="n">Node</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List of nodes in the agent, order of the list used to determine the priority during activation. Nodes must have unique names.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">_manager</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">extra</span><span class="o">=</span><span class="s2">&quot;forbid&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">model_post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__context</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="c1"># by default use the class name without the values for type variables</span>
            <span class="c1"># e.g. &quot;Agent&quot; instea of &quot;Agent[Tape[...]]&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">Agent</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent is already a subagent of another agent. Make a copy of your agent.&quot;</span><span class="p">)</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">_manager</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subagents must be instances of Agent&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Duplicate subagent name &quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; in subagent </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, pass a unique name to the subagent during creation&#39;</span>
                <span class="p">)</span>
            <span class="n">names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">node_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">node_names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Duplicate node name &quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; in node </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, pass a unique name to the node during creation&#39;</span>
                <span class="p">)</span>
            <span class="n">node_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_post_init</span><span class="p">(</span><span class="n">__context</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the manager of the agent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Agent): The manager agent instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the agent doesn&#39;t have a manager assigned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent doesn&#39;t have a manager&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">llm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the default LLM instance associated with the agent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (LLM): The default LLM instance if only one LLM is configured.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If multiple LLMs are configured for this agent. In this case, use the `llms`</span>
<span class="sd">                       property to access specific LLM instances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent has multiple LLMs. Use llms property to access a specific one.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">llms</span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the default template of the agent.</span>

<span class="sd">        This property provides access to the default template when the agent has exactly one template.</span>
<span class="sd">        If multiple templates exist, it raises a ValueError indicating that specific templates</span>
<span class="sd">        should be accessed through the templates property instead.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Template): The default template object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the agent has more than one template.</span>
<span class="sd">            IndexError: If no templates exist (implicitly through list access).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent has multiple templates. Use templates property to access a specific one.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the full hierarchical name of the agent.</span>

<span class="sd">        The full name is constructed by combining the manager&#39;s full name (if present)</span>
<span class="sd">        with this agent&#39;s name, separated by a forward slash. If the agent has no</span>
<span class="sd">        manager, returns just the agent&#39;s name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (str): The full hierarchical name path of the agent. Examples: &quot;agent_name&quot; (no manager), &quot;manager_name/agent_name&quot; (with manager)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">full_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">find_subagent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a subagent by name in the list of subagents.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the subagent to find.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Agent): The found subagent instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no subagent with the given name is found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">agent</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find a node by its name in the list of nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the node to find.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Node): The node with the matching name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no node with the given name is found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">node</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_subagent_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of names of all subagents.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: A list containing the names of all subagents in the agent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a deep copy of the current agent instance.</span>

<span class="sd">        This method creates an independent copy of the agent with all its attributes,</span>
<span class="sd">        but detaches it from any manager.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self: A new instance of the agent with identical attributes but no manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">llms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">LLM</span><span class="p">]</span> <span class="o">|</span> <span class="n">LLM</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">templates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance of the class with provided LLMs and templates.</span>

<span class="sd">        Args:</span>
<span class="sd">            llms (Union[Dict[str, LLM], LLM, None]): Language model(s) to use. Can be:</span>

<span class="sd">                - A dictionary mapping names to LLM instances</span>
<span class="sd">                - A single LLM instance (will be mapped to default name)</span>
<span class="sd">                - None (empty dict will be used)</span>
<span class="sd">            templates (Union[Dict[str, Any], str, None]): Template(s) to use. Can be:</span>

<span class="sd">                - A dictionary mapping names to template configurations</span>
<span class="sd">                - A single template string (will be mapped to default name)</span>
<span class="sd">                - None (no templates will be used)</span>
<span class="sd">            **kwargs (dict, optional): Additional keyword arguments to pass to the class constructor</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self: A new instance of the class initialized with the provided arguments</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            agent = Agent.create(llm)  # Single LLM</span>
<span class="sd">            agent = Agent.create({&quot;gpt&quot;: llm1, &quot;claude&quot;: llm2})  # Multiple LLMs</span>
<span class="sd">            agent = Agent.create(llm, &quot;template&quot;)  # LLM with template</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llms</span><span class="p">,</span> <span class="n">LLM</span><span class="p">):</span>
            <span class="n">llms</span> <span class="o">=</span> <span class="p">{</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="n">llms</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="n">templates</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;templates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">templates</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">llms</span><span class="o">=</span><span class="n">llms</span> <span class="ow">or</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Agent</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the agent&#39;s configuration while preserving instance types.</span>

<span class="sd">        This method allows reconfiguration of the agent while maintaining the class types</span>
<span class="sd">        of LLMs and subagents. It performs a deep update by recursively applying changes</span>
<span class="sd">        to nested components.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent_config (dict[str, Any]): New configuration dictionary containing LLMs,</span>
<span class="sd">                subagents, templates and other agent settings.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Agent[TapeType]: A new agent instance with updated configuration.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the new configuration has different LLMs or number of subagents</span>
<span class="sd">                than the current agent.</span>

<span class="sd">        Note:</span>
<span class="sd">            - Only string templates are updated, complex template objects are preserved</span>
<span class="sd">            - Node configurations are preserved to avoid potential issues</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;llms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent has different LLMs than the new configuration.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;subagents&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent has different number of subagents than the new configuration.&quot;</span><span class="p">)</span>
        <span class="c1"># recurse into subagents</span>
        <span class="n">subagents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">subagent</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">subagent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subagent_obj</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">subagent</span><span class="p">,</span> <span class="n">subagent_obj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">,</span> <span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;subagents&quot;</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="c1"># recurse into llms</span>
        <span class="n">llms</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">llm</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;llms&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">llm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">llms</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># only update templates are str</span>
        <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="p">(</span><span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;templates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">config_copy</span> <span class="o">=</span> <span class="n">agent_config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;llms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">llms</span>
        <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;subagents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subagents</span>
        <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;templates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">templates</span>
        <span class="c1"># do not update nodes for now to avoid tricky bugs</span>
        <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">config_copy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TapeViewStack</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the view stack from a given tape.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The input tape to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TapeViewStack: A stack of views computed from the input tape.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TapeViewStack</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select the next node to execute based on the current state of the tape.</span>

<span class="sd">        The selection process follows these rules:</span>
<span class="sd">            1. If next_node is explicitly set in the tape view, return that node</span>
<span class="sd">            2. If no nodes have been run yet (last_node is None), return the first node</span>
<span class="sd">            3. Return the node that follows the last executed node in the list</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The tape containing execution state and data</span>

<span class="sd">        Returns:</span>
<span class="sd">            Node: The next node to be executed</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If unable to determine the next node to execute (e.g., reached end of list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Select the node to run next based on the current state of the tape.</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_view</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span><span class="o">.</span><span class="n">top</span>
        <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">next_node</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Next node was set explicitly in the tape: </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">next_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">next_node</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">view</span><span class="o">.</span><span class="n">last_node</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: No nodes have been run yet, select node 0: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Select the next node that stored after the last node found in the tape</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Last node in view: </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">last_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Known nodes: </span><span class="si">{</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">view</span><span class="o">.</span><span class="n">last_node</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Select immediate next node: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Next node not found&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Prompt</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes the prompt for the next iteration of the agent.</span>
<span class="sd">        This method generates a prompt by delegating to the selected node&#39;s make_prompt method.</span>
<span class="sd">        Can return a prompt with no messages, indicating the agent should generate next steps</span>
<span class="sd">        by following rules without LLM assistance. Agents that only delegate to subagents may</span>
<span class="sd">        not need to implement this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The tape containing the agent&#39;s state and history</span>

<span class="sd">        Returns:</span>
<span class="sd">            Prompt: A prompt object for the next agent iteration, potentially empty</span>

<span class="sd">        Note:</span>
<span class="sd">            - Empty prompts signal rule-based generation without LLM</span>
<span class="sd">            - Method may be optional for pure delegation agents</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_node</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span><span class="o">.</span><span class="n">make_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">:</span> <span class="n">LLMStream</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Step</span> <span class="o">|</span> <span class="n">PartialStep</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate steps from the agent by selecting a node and processing its output.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The input tape containing the interaction history</span>
<span class="sd">            llm_stream (LLMStream): Stream interface for the language model output</span>

<span class="sd">        Yields:</span>
<span class="sd">            Union[Step, PartialStep]: Union[Step, PartialStep]: The generated steps or partial steps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate new steps and other events by feeding the prompt to the LLM</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_node</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">generate_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">AgentStep</span><span class="p">):</span>
                <span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
            <span class="k">yield</span> <span class="n">step</span>

    <span class="k">def</span> <span class="nf">make_llm_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMOutput</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates an LLM output based on a tape and step index.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The input tape</span>
<span class="sd">            index (int): The position in the tape up to which to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            LLMOutput: The generated language model output for the tape segment.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method delegates the actual output generation to the selected node&#39;s</span>
<span class="sd">            make_llm_output method after selecting the appropriate node based on the</span>
<span class="sd">            tape segment up to the given index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_node</span><span class="p">(</span><span class="n">tape</span><span class="p">[:</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">make_llm_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Agent</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delegates control to the appropriate subagent based on the current tape state.</span>

<span class="sd">        This method recursively traverses the agent hierarchy to find the most specific</span>
<span class="sd">        subagent that should handle the current tape state based on views computed from</span>
<span class="sd">        the tape.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The tape containing the current state to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Agent[TapeType]: The subagent that should handle the current tape state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">views</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_view</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
        <span class="n">subagent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">subagent</span> <span class="o">=</span> <span class="n">subagent</span><span class="o">.</span><span class="n">find_subagent</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">agent_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="si">}</span><span class="s2">: Delegating to subagent: </span><span class="si">{</span><span class="n">subagent</span><span class="o">.</span><span class="n">full_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subagent</span>

    <span class="k">def</span> <span class="nf">is_agent_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if a step was produced by the agent.</span>

<span class="sd">        Args:</span>
<span class="sd">            step (Step): The step object to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the step is an Action or Thought (agent-produced),</span>
<span class="sd">                  False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="p">(</span><span class="n">Action</span><span class="p">,</span> <span class="n">Thought</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">should_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the agent should stop its turn and wait for observations.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The tape containing the sequence of steps (actions and observations).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the last step in the tape is an Action, indicating the agent should stop and wait for observations.</span>
<span class="sd">                 False if the last step is not an Action, indicating the agent can continue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run_iteration</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">:</span> <span class="n">LLMStream</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Step</span> <span class="o">|</span> <span class="n">PartialStep</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run one iteration of the agent (assuming one call to the underlyng model).</span>

<span class="sd">        During an iteration the agent generates steps from a stream of tokens that arises</span>
<span class="sd">        from a single LLM call with a single prompt. An agent can do multiple iterations</span>
<span class="sd">        before returning the next action (see `run` method).</span>

<span class="sd">        This function can also take a given `llm_stream`, which can be useful when the agent</span>
<span class="sd">        reuses a tape.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The tape to run the agent on</span>
<span class="sd">            llm_stream (LLMStream): The stream of tokens from the LLM</span>

<span class="sd">        Yields:</span>
<span class="sd">            Union[Step, PartialStep]: The generated steps or partial</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the agent has multiple LLMs and no LLM stream is provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">llm_stream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_prompt</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;TODO: implement LLM choice in the prompt&quot;</span><span class="p">)</span>
            <span class="n">llm_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="k">if</span> <span class="n">prompt</span> <span class="k">else</span> <span class="n">LLMStream</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_steps</span><span class="p">(</span><span class="n">tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">AgentStep</span><span class="p">):</span>
                <span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">prompt_id</span> <span class="o">=</span> <span class="n">llm_stream</span><span class="o">.</span><span class="n">prompt</span><span class="o">.</span><span class="n">id</span>
            <span class="k">yield</span> <span class="n">step</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">,</span> <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentStream</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the agent on the tape iteratively, delegating to subagents until a stop condition is met.</span>

<span class="sd">        This method executes the agent&#39;s logic by:</span>
<span class="sd">        1. Delegating to appropriate subagents based on the tape state</span>
<span class="sd">        2. Processing steps from subagent iterations</span>
<span class="sd">        3. Updating the tape with new steps</span>
<span class="sd">        4. Checking stop conditions</span>
<span class="sd">        5. Tracking metadata about the execution</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The input tape to process</span>
<span class="sd">            max_iterations (int, optional): Maximum number of iterations to run.</span>
<span class="sd">                If None, uses self.max_iterations. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AgentStream[TapeType]: A stream of AgentEvents containing:</span>

<span class="sd">                - partial_step: Intermediate processing steps</span>
<span class="sd">                - step: Completed agent steps with updated tape</span>
<span class="sd">                - final_tape: Final tape with updated metadata after completion</span>

<span class="sd">        Yields:</span>
<span class="sd">            AgentEvent: Events indicating the agent&#39;s progress including partial steps,</span>
<span class="sd">                completed steps with updated tape, and the final result.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the agent generates anything other than steps or partial steps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_iterations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iterations</span>

        <span class="k">def</span> <span class="nf">_run_implementation</span><span class="p">():</span>
            <span class="k">nonlocal</span> <span class="n">tape</span>
            <span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">input_tape_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
            <span class="n">input_tape_id</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">id</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="n">n_iterations</span> <span class="o">&lt;</span> <span class="n">max_iterations</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
                <span class="n">current_subagent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delegate</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">current_subagent</span><span class="o">.</span><span class="n">run_iteration</span><span class="p">(</span><span class="n">tape</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">PartialStep</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">AgentEvent</span><span class="p">(</span><span class="n">partial_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">AgentStep</span><span class="p">):</span>
                        <span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="n">current_subagent</span><span class="o">.</span><span class="n">full_name</span>
                        <span class="n">tape</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="n">AgentEvent</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">partial_tape</span><span class="o">=</span><span class="n">tape</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_stop</span><span class="p">(</span><span class="n">tape</span><span class="p">):</span>
                            <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent can only generate steps or partial steps&quot;</span><span class="p">)</span>
                <span class="n">n_iterations</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">updated_metadata</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span>
                <span class="n">update</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">parent_id</span><span class="o">=</span><span class="n">input_tape_id</span><span class="p">,</span>
                    <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">n_added_steps</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span> <span class="o">-</span> <span class="n">input_tape_length</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">final_tape</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">updated_metadata</span><span class="p">))</span>
            <span class="k">yield</span> <span class="n">AgentEvent</span><span class="p">(</span><span class="n">final_tape</span><span class="o">=</span><span class="n">final_tape</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">AgentStream</span><span class="p">(</span><span class="n">_run_implementation</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">reuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TapeType</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">LLMCall</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reuse another agent&#39;s tape as one&#39;s own.</span>

<span class="sd">        Construct LLM outputs at each step where a prompt is made. Check that output</span>
<span class="sd">        parsing yield the same steps as in the original tape. Rewrite metadata for all steps.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The tape to reuse</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[TapeType, list[LLMCall]]: The reused tape and a list of LLM calls made during the reuse</span>

<span class="sd">        Raises:</span>
<span class="sd">            TapeReuseFailure: If the regenerated steps don&#39;t match the original tape.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reused_steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">llm_calls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tape</span><span class="p">):</span>
            <span class="n">past_tape</span> <span class="o">=</span> <span class="n">tape</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_agent_step</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
                <span class="n">current_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delegate</span><span class="p">(</span><span class="n">past_tape</span><span class="p">)</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="n">current_agent</span><span class="o">.</span><span class="n">make_prompt</span><span class="p">(</span><span class="n">past_tape</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span><span class="p">:</span>
                    <span class="n">reused_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">current_agent</span><span class="o">.</span><span class="n">make_llm_output</span><span class="p">(</span><span class="n">tape</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">llm_call</span> <span class="o">=</span> <span class="n">LLMCall</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">observe_llm_call</span><span class="p">(</span><span class="n">llm_call</span><span class="p">)</span>

                <span class="c1"># Validate that the reconstructed llm call leads to the same steps as in the given tape</span>
                <span class="k">def</span> <span class="nf">_generator</span><span class="p">():</span>
                    <span class="k">yield</span> <span class="n">LLMEvent</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

                <span class="n">new_steps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_agent</span><span class="o">.</span><span class="n">run_iteration</span><span class="p">(</span><span class="n">past_tape</span><span class="p">,</span> <span class="n">LLMStream</span><span class="p">(</span><span class="n">_generator</span><span class="p">(),</span> <span class="n">prompt</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">new_step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_steps</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_step</span><span class="p">,</span> <span class="n">Step</span><span class="p">)</span>
                    <span class="n">old_step</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">old_step</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_step</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">_is_step_data_equal</span><span class="p">(</span><span class="n">old_step</span><span class="p">,</span> <span class="n">new_step</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">TapeReuseFailure</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Can&#39;t reuse tape because regenerated step </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="si">}</span><span class="s2"> data doesn&#39;t match&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">old step data: </span><span class="si">{</span><span class="n">old_step</span><span class="o">.</span><span class="n">llm_dict</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">new step data: </span><span class="si">{</span><span class="n">new_step</span><span class="o">.</span><span class="n">llm_dict</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">partial_tape</span><span class="o">=</span><span class="n">past_tape</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="n">llm_calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">llm_call</span><span class="p">)</span>
                <span class="n">reused_steps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_steps</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_steps</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reused_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">reused_tape</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">tape</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">TapeMetadata</span><span class="p">(),</span> <span class="n">steps</span><span class="o">=</span><span class="n">reused_steps</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reused_tape</span><span class="p">,</span> <span class="n">llm_calls</span>

    <span class="k">def</span> <span class="nf">get_node_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the tape and identify the indices where each node began its execution.</span>

<span class="sd">        This method identifies transition points in the tape where different nodes started</span>
<span class="sd">        producing output by tracking changes in prompt IDs.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): The sequence of tape steps to analyze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[tuple[Node, int]]: List of tuples containing (node, index) pairs where:</span>

<span class="sd">                - node: The Node object that produced the tape fragment</span>
<span class="sd">                - index: The starting index in the tape where this node began execution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_prompt_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tape</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prompt_id</span> <span class="o">:=</span> <span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">prompt_id</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prompt_id</span> <span class="o">!=</span> <span class="n">last_prompt_id</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="n">last_prompt_id</span> <span class="o">=</span> <span class="n">prompt_id</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">make_training_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm_call</span><span class="p">:</span> <span class="n">LLMCall</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainingText</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Routes the request to make training text to the agent&#39;s LLM.</span>

<span class="sd">        Args:</span>
<span class="sd">            llm_call (LLMCall): Object containing prompt and output from an LLM call.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TrainingText: The training text generated from the prompt and output.</span>

<span class="sd">        Note:</span>
<span class="sd">            Currently only supports one LLM. Future versions will support multiple LLMs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: support more than 1 LLM</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">make_training_text</span><span class="p">(</span><span class="n">llm_call</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span> <span class="n">llm_call</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">TrainingText</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates training data from a tape by converting LLM calls into training texts.</span>

<span class="sd">        Args:</span>
<span class="sd">            tape (TapeType): A tape containing recorded LLM interactions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[TrainingText]: A list of training text objects created from the LLM calls.</span>

<span class="sd">        Notes:</span>
<span class="sd">            This method first reuses the tape to extract LLM calls, then converts each call</span>
<span class="sd">            into a training text format using make_training_text().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">llm_calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">make_training_text</span><span class="p">(</span><span class="n">llm_call</span><span class="p">)</span> <span class="k">for</span> <span class="n">llm_call</span> <span class="ow">in</span> <span class="n">llm_calls</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tapeagents.agent.Agent.full_name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">full_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the full hierarchical name of the agent.</p>
<p>The full name is constructed by combining the manager's full name (if present)
with this agent's name, separated by a forward slash. If the agent has no
manager, returns just the agent's name.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>str</code>
          –
          <div class="doc-md-description">
            <p>The full hierarchical name path of the agent. Examples: "agent_name" (no manager), "manager_name/agent_name" (with manager)</p>
          </div>
        </li>
    </ul>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tapeagents.agent.Agent.llm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">llm</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the default LLM instance associated with the agent.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.llms.LLM" href="../llms/#tapeagents.llms.LLM">LLM</a></code>
          –
          <div class="doc-md-description">
            <p>The default LLM instance if only one LLM is configured.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If multiple LLMs are configured for this agent. In this case, use the <code>llms</code>
       property to access specific LLM instances.</p>
          </div>
        </li>
    </ul>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tapeagents.agent.Agent.manager" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">manager</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the manager of the agent.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent" href="#tapeagents.agent.Agent">Agent</a></code>
          –
          <div class="doc-md-description">
            <p>The manager agent instance.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If the agent doesn't have a manager assigned.</p>
          </div>
        </li>
    </ul>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tapeagents.agent.Agent.template" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">template</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the default template of the agent.</p>
<p>This property provides access to the default template when the agent has exactly one template.
If multiple templates exist, it raises a ValueError indicating that specific templates
should be accessed through the templates property instead.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>Template</code>
          –
          <div class="doc-md-description">
            <p>The default template object.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If the agent has more than one template.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code>IndexError</code>
            –
          <div class="doc-md-description">
            <p>If no templates exist (implicitly through list access).</p>
          </div>
        </li>
    </ul>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.clone" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">clone</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a deep copy of the current agent instance.</p>
<p>This method creates an independent copy of the agent with all its attributes,
but detaches it from any manager.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Self</code></b> (              <code><span title="typing_extensions.Self">Self</span></code>
)          –
          <div class="doc-md-description">
            <p>A new instance of the agent with identical attributes but no manager.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a deep copy of the current agent instance.</span>

<span class="sd">    This method creates an independent copy of the agent with all its attributes,</span>
<span class="sd">    but detaches it from any manager.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Self: A new instance of the agent with identical attributes but no manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_manager</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.compute_view" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">compute_view</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the view stack from a given tape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The input tape to process.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>TapeViewStack</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.view.TapeViewStack" href="../view/#tapeagents.view.TapeViewStack">TapeViewStack</a></code>
)          –
          <div class="doc-md-description">
            <p>A stack of views computed from the input tape.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TapeViewStack</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the view stack from a given tape.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The input tape to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TapeViewStack: A stack of views computed from the input tape.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TapeViewStack</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.create" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="n">llms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">templates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates an instance of the class with provided LLMs and templates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>llms</code></b>
              (<code>Union[Dict[str, <a class="autorefs autorefs-internal" title="tapeagents.llms.LLM" href="../llms/#tapeagents.llms.LLM">LLM</a>], <a class="autorefs autorefs-internal" title="tapeagents.llms.LLM" href="../llms/#tapeagents.llms.LLM">LLM</a>, None]</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Language model(s) to use. Can be:</p>
<ul>
<li>A dictionary mapping names to LLM instances</li>
<li>A single LLM instance (will be mapped to default name)</li>
<li>None (empty dict will be used)</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>templates</code></b>
              (<code>Union[Dict[str, <span title="typing.Any">Any</span>], str, None]</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Template(s) to use. Can be:</p>
<ul>
<li>A dictionary mapping names to template configurations</li>
<li>A single template string (will be mapped to default name)</li>
<li>None (no templates will be used)</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>**kwargs</code></b>
              (<code>dict</code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Additional keyword arguments to pass to the class constructor</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Self</code></b> (              <code><span title="typing_extensions.Self">Self</span></code>
)          –
          <div class="doc-md-description">
            <p>A new instance of the class initialized with the provided arguments</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <pre><code class="language-python">agent = Agent.create(llm)  # Single LLM
agent = Agent.create({&quot;gpt&quot;: llm1, &quot;claude&quot;: llm2})  # Multiple LLMs
agent = Agent.create(llm, &quot;template&quot;)  # LLM with template
</code></pre>
</details>
            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">llms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">LLM</span><span class="p">]</span> <span class="o">|</span> <span class="n">LLM</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">templates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of the class with provided LLMs and templates.</span>

<span class="sd">    Args:</span>
<span class="sd">        llms (Union[Dict[str, LLM], LLM, None]): Language model(s) to use. Can be:</span>

<span class="sd">            - A dictionary mapping names to LLM instances</span>
<span class="sd">            - A single LLM instance (will be mapped to default name)</span>
<span class="sd">            - None (empty dict will be used)</span>
<span class="sd">        templates (Union[Dict[str, Any], str, None]): Template(s) to use. Can be:</span>

<span class="sd">            - A dictionary mapping names to template configurations</span>
<span class="sd">            - A single template string (will be mapped to default name)</span>
<span class="sd">            - None (no templates will be used)</span>
<span class="sd">        **kwargs (dict, optional): Additional keyword arguments to pass to the class constructor</span>

<span class="sd">    Returns:</span>
<span class="sd">        Self: A new instance of the class initialized with the provided arguments</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        agent = Agent.create(llm)  # Single LLM</span>
<span class="sd">        agent = Agent.create({&quot;gpt&quot;: llm1, &quot;claude&quot;: llm2})  # Multiple LLMs</span>
<span class="sd">        agent = Agent.create(llm, &quot;template&quot;)  # LLM with template</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llms</span><span class="p">,</span> <span class="n">LLM</span><span class="p">):</span>
        <span class="n">llms</span> <span class="o">=</span> <span class="p">{</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="n">llms</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="n">templates</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">templates</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;templates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">templates</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">llms</span><span class="o">=</span><span class="n">llms</span> <span class="ow">or</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.delegate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">delegate</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delegates control to the appropriate subagent based on the current tape state.</p>
<p>This method recursively traverses the agent hierarchy to find the most specific
subagent that should handle the current tape state based on views computed from
the tape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape containing the current state to process.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent" href="#tapeagents.agent.Agent">Agent</a>[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>]</code>
          –
          <div class="doc-md-description">
            <p>Agent[TapeType]: The subagent that should handle the current tape state.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Agent</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delegates control to the appropriate subagent based on the current tape state.</span>

<span class="sd">    This method recursively traverses the agent hierarchy to find the most specific</span>
<span class="sd">    subagent that should handle the current tape state based on views computed from</span>
<span class="sd">    the tape.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The tape containing the current state to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Agent[TapeType]: The subagent that should handle the current tape state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">views</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_view</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
    <span class="n">subagent</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">subagent</span> <span class="o">=</span> <span class="n">subagent</span><span class="o">.</span><span class="n">find_subagent</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">agent_name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="si">}</span><span class="s2">: Delegating to subagent: </span><span class="si">{</span><span class="n">subagent</span><span class="o">.</span><span class="n">full_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subagent</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.find_node" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">find_node</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Find a node by its name in the list of nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>name</code></b>
              (<code>str</code>)
          –
          <div class="doc-md-description">
            <p>The name of the node to find.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.Node" href="#tapeagents.agent.Node">Node</a></code>
          –
          <div class="doc-md-description">
            <p>The node with the matching name.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If no node with the given name is found.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find a node by its name in the list of nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the node to find.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Node): The node with the matching name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no node with the given name is found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.find_subagent" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">find_subagent</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Find a subagent by name in the list of subagents.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>name</code></b>
              (<code>str</code>)
          –
          <div class="doc-md-description">
            <p>The name of the subagent to find.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent" href="#tapeagents.agent.Agent">Agent</a></code>
          –
          <div class="doc-md-description">
            <p>The found subagent instance.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If no subagent with the given name is found.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_subagent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find a subagent by name in the list of subagents.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the subagent to find.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Agent): The found subagent instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no subagent with the given name is found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">agent</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.generate_steps" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">generate_steps</span><span class="p">(</span><span class="n">tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate steps from the agent by selecting a node and processing its output.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The input tape containing the interaction history</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>llm_stream</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.llms.LLMStream" href="../llms/#tapeagents.llms.LLMStream">LLMStream</a></code>)
          –
          <div class="doc-md-description">
            <p>Stream interface for the language model output</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Yields:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.core.Step" href="../core/#tapeagents.core.Step">Step</a> | <a class="autorefs autorefs-internal" title="tapeagents.core.PartialStep" href="../core/#tapeagents.core.PartialStep">PartialStep</a></code>
          –
          <div class="doc-md-description">
            <p>Union[Step, PartialStep]: Union[Step, PartialStep]: The generated steps or partial steps.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">:</span> <span class="n">LLMStream</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Step</span> <span class="o">|</span> <span class="n">PartialStep</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate steps from the agent by selecting a node and processing its output.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The input tape containing the interaction history</span>
<span class="sd">        llm_stream (LLMStream): Stream interface for the language model output</span>

<span class="sd">    Yields:</span>
<span class="sd">        Union[Step, PartialStep]: Union[Step, PartialStep]: The generated steps or partial steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate new steps and other events by feeding the prompt to the LLM</span>
    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_node</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">generate_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">AgentStep</span><span class="p">):</span>
            <span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
        <span class="k">yield</span> <span class="n">step</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.get_node_runs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_node_runs</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Parse the tape and identify the indices where each node began its execution.</p>
<p>This method identifies transition points in the tape where different nodes started
producing output by tracking changes in prompt IDs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The sequence of tape steps to analyze.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>list[tuple[<a class="autorefs autorefs-internal" title="tapeagents.agent.Node" href="#tapeagents.agent.Node">Node</a>, int]]</code>
          –
          <div class="doc-md-description">
            <p>list[tuple[Node, int]]: List of tuples containing (node, index) pairs where:</p>
<ul>
<li>node: The Node object that produced the tape fragment</li>
<li>index: The starting index in the tape where this node began execution</li>
</ul>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_node_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the tape and identify the indices where each node began its execution.</span>

<span class="sd">    This method identifies transition points in the tape where different nodes started</span>
<span class="sd">    producing output by tracking changes in prompt IDs.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The sequence of tape steps to analyze.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple[Node, int]]: List of tuples containing (node, index) pairs where:</span>

<span class="sd">            - node: The Node object that produced the tape fragment</span>
<span class="sd">            - index: The starting index in the tape where this node began execution</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_prompt_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tape</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prompt_id</span> <span class="o">:=</span> <span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">prompt_id</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prompt_id</span> <span class="o">!=</span> <span class="n">last_prompt_id</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
        <span class="n">last_prompt_id</span> <span class="o">=</span> <span class="n">prompt_id</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.get_subagent_names" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_subagent_names</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a list of names of all subagents.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>list[str]</code>
          –
          <div class="doc-md-description">
            <p>list[str]: A list containing the names of all subagents in the agent.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_subagent_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of names of all subagents.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: A list containing the names of all subagents in the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.is_agent_step" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">is_agent_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if a step was produced by the agent.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>step</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.Step" href="../core/#tapeagents.core.Step">Step</a></code>)
          –
          <div class="doc-md-description">
            <p>The step object to check.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>bool</code></b> (              <code>bool</code>
)          –
          <div class="doc-md-description">
            <p>True if the step is an Action or Thought (agent-produced),
  False otherwise.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_agent_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a step was produced by the agent.</span>

<span class="sd">    Args:</span>
<span class="sd">        step (Step): The step object to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the step is an Action or Thought (agent-produced),</span>
<span class="sd">              False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="p">(</span><span class="n">Action</span><span class="p">,</span> <span class="n">Thought</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.make_llm_output" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">make_llm_output</span><span class="p">(</span><span class="n">tape</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates an LLM output based on a tape and step index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The input tape</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>index</code></b>
              (<code>int</code>)
          –
          <div class="doc-md-description">
            <p>The position in the tape up to which to process.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>LLMOutput</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.core.LLMOutput" href="../core/#tapeagents.core.LLMOutput">LLMOutput</a></code>
)          –
          <div class="doc-md-description">
            <p>The generated language model output for the tape segment.</p>
          </div>
        </li>
    </ul>


<details class="note" open>
  <summary>Note</summary>
  <p>This method delegates the actual output generation to the selected node's
make_llm_output method after selecting the appropriate node based on the
tape segment up to the given index.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_llm_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates an LLM output based on a tape and step index.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The input tape</span>
<span class="sd">        index (int): The position in the tape up to which to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        LLMOutput: The generated language model output for the tape segment.</span>

<span class="sd">    Note:</span>
<span class="sd">        This method delegates the actual output generation to the selected node&#39;s</span>
<span class="sd">        make_llm_output method after selecting the appropriate node based on the</span>
<span class="sd">        tape segment up to the given index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_node</span><span class="p">(</span><span class="n">tape</span><span class="p">[:</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">make_llm_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.make_prompt" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">make_prompt</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Makes the prompt for the next iteration of the agent.
This method generates a prompt by delegating to the selected node's make_prompt method.
Can return a prompt with no messages, indicating the agent should generate next steps
by following rules without LLM assistance. Agents that only delegate to subagents may
not need to implement this method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape containing the agent's state and history</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Prompt</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.core.Prompt" href="../core/#tapeagents.core.Prompt">Prompt</a></code>
)          –
          <div class="doc-md-description">
            <p>A prompt object for the next agent iteration, potentially empty</p>
          </div>
        </li>
    </ul>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Empty prompts signal rule-based generation without LLM</li>
<li>Method may be optional for pure delegation agents</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Prompt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes the prompt for the next iteration of the agent.</span>
<span class="sd">    This method generates a prompt by delegating to the selected node&#39;s make_prompt method.</span>
<span class="sd">    Can return a prompt with no messages, indicating the agent should generate next steps</span>
<span class="sd">    by following rules without LLM assistance. Agents that only delegate to subagents may</span>
<span class="sd">    not need to implement this method.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The tape containing the agent&#39;s state and history</span>

<span class="sd">    Returns:</span>
<span class="sd">        Prompt: A prompt object for the next agent iteration, potentially empty</span>

<span class="sd">    Note:</span>
<span class="sd">        - Empty prompts signal rule-based generation without LLM</span>
<span class="sd">        - Method may be optional for pure delegation agents</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_node</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span><span class="o">.</span><span class="n">make_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.make_training_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">make_training_data</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates training data from a tape by converting LLM calls into training texts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>A tape containing recorded LLM interactions.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>list[<a class="autorefs autorefs-internal" title="tapeagents.core.TrainingText" href="../core/#tapeagents.core.TrainingText">TrainingText</a>]</code>
          –
          <div class="doc-md-description">
            <p>list[TrainingText]: A list of training text objects created from the LLM calls.</p>
          </div>
        </li>
    </ul>


<details class="notes" open>
  <summary>Notes</summary>
  <p>This method first reuses the tape to extract LLM calls, then converts each call
into a training text format using make_training_text().</p>
</details>
            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">TrainingText</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates training data from a tape by converting LLM calls into training texts.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): A tape containing recorded LLM interactions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[TrainingText]: A list of training text objects created from the LLM calls.</span>

<span class="sd">    Notes:</span>
<span class="sd">        This method first reuses the tape to extract LLM calls, then converts each call</span>
<span class="sd">        into a training text format using make_training_text().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">llm_calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">make_training_text</span><span class="p">(</span><span class="n">llm_call</span><span class="p">)</span> <span class="k">for</span> <span class="n">llm_call</span> <span class="ow">in</span> <span class="n">llm_calls</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.make_training_text" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">make_training_text</span><span class="p">(</span><span class="n">llm_call</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Routes the request to make training text to the agent's LLM.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>llm_call</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.LLMCall" href="../core/#tapeagents.core.LLMCall">LLMCall</a></code>)
          –
          <div class="doc-md-description">
            <p>Object containing prompt and output from an LLM call.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>TrainingText</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.core.TrainingText" href="../core/#tapeagents.core.TrainingText">TrainingText</a></code>
)          –
          <div class="doc-md-description">
            <p>The training text generated from the prompt and output.</p>
          </div>
        </li>
    </ul>


<details class="note" open>
  <summary>Note</summary>
  <p>Currently only supports one LLM. Future versions will support multiple LLMs.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_training_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm_call</span><span class="p">:</span> <span class="n">LLMCall</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainingText</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Routes the request to make training text to the agent&#39;s LLM.</span>

<span class="sd">    Args:</span>
<span class="sd">        llm_call (LLMCall): Object containing prompt and output from an LLM call.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TrainingText: The training text generated from the prompt and output.</span>

<span class="sd">    Note:</span>
<span class="sd">        Currently only supports one LLM. Future versions will support multiple LLMs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: support more than 1 LLM</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">make_training_text</span><span class="p">(</span><span class="n">llm_call</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span> <span class="n">llm_call</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.reuse" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">reuse</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reuse another agent's tape as one's own.</p>
<p>Construct LLM outputs at each step where a prompt is made. Check that output
parsing yield the same steps as in the original tape. Rewrite metadata for all steps.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape to reuse</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>, list[<a class="autorefs autorefs-internal" title="tapeagents.core.LLMCall" href="../core/#tapeagents.core.LLMCall">LLMCall</a>]]</code>
          –
          <div class="doc-md-description">
            <p>tuple[TapeType, list[LLMCall]]: The reused tape and a list of LLM calls made during the reuse</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.TapeReuseFailure" href="#tapeagents.agent.TapeReuseFailure">TapeReuseFailure</a></code>
            –
          <div class="doc-md-description">
            <p>If the regenerated steps don't match the original tape.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">TapeType</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">LLMCall</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reuse another agent&#39;s tape as one&#39;s own.</span>

<span class="sd">    Construct LLM outputs at each step where a prompt is made. Check that output</span>
<span class="sd">    parsing yield the same steps as in the original tape. Rewrite metadata for all steps.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The tape to reuse</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[TapeType, list[LLMCall]]: The reused tape and a list of LLM calls made during the reuse</span>

<span class="sd">    Raises:</span>
<span class="sd">        TapeReuseFailure: If the regenerated steps don&#39;t match the original tape.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reused_steps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">llm_calls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tape</span><span class="p">):</span>
        <span class="n">past_tape</span> <span class="o">=</span> <span class="n">tape</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_agent_step</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
            <span class="n">current_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delegate</span><span class="p">(</span><span class="n">past_tape</span><span class="p">)</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">current_agent</span><span class="o">.</span><span class="n">make_prompt</span><span class="p">(</span><span class="n">past_tape</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span><span class="p">:</span>
                <span class="n">reused_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">current_agent</span><span class="o">.</span><span class="n">make_llm_output</span><span class="p">(</span><span class="n">tape</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">llm_call</span> <span class="o">=</span> <span class="n">LLMCall</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">observe_llm_call</span><span class="p">(</span><span class="n">llm_call</span><span class="p">)</span>

            <span class="c1"># Validate that the reconstructed llm call leads to the same steps as in the given tape</span>
            <span class="k">def</span> <span class="nf">_generator</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">LLMEvent</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

            <span class="n">new_steps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_agent</span><span class="o">.</span><span class="n">run_iteration</span><span class="p">(</span><span class="n">past_tape</span><span class="p">,</span> <span class="n">LLMStream</span><span class="p">(</span><span class="n">_generator</span><span class="p">(),</span> <span class="n">prompt</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">new_step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_steps</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_step</span><span class="p">,</span> <span class="n">Step</span><span class="p">)</span>
                <span class="n">old_step</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">old_step</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_step</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">_is_step_data_equal</span><span class="p">(</span><span class="n">old_step</span><span class="p">,</span> <span class="n">new_step</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">TapeReuseFailure</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Can&#39;t reuse tape because regenerated step </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="si">}</span><span class="s2"> data doesn&#39;t match&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">old step data: </span><span class="si">{</span><span class="n">old_step</span><span class="o">.</span><span class="n">llm_dict</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">new step data: </span><span class="si">{</span><span class="n">new_step</span><span class="o">.</span><span class="n">llm_dict</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">partial_tape</span><span class="o">=</span><span class="n">past_tape</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="n">llm_calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">llm_call</span><span class="p">)</span>
            <span class="n">reused_steps</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_steps</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_steps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reused_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">reused_tape</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">tape</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">TapeMetadata</span><span class="p">(),</span> <span class="n">steps</span><span class="o">=</span><span class="n">reused_steps</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">reused_tape</span><span class="p">,</span> <span class="n">llm_calls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">tape</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Run the agent on the tape iteratively, delegating to subagents until a stop condition is met.</p>
<p>This method executes the agent's logic by:
1. Delegating to appropriate subagents based on the tape state
2. Processing steps from subagent iterations
3. Updating the tape with new steps
4. Checking stop conditions
5. Tracking metadata about the execution</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The input tape to process</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>max_iterations</code></b>
              (<code>int</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Maximum number of iterations to run.
If None, uses self.max_iterations. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.AgentStream" href="#tapeagents.agent.AgentStream">AgentStream</a>[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>]</code>
          –
          <div class="doc-md-description">
            <p>AgentStream[TapeType]: A stream of AgentEvents containing:</p>
<ul>
<li>partial_step: Intermediate processing steps</li>
<li>step: Completed agent steps with updated tape</li>
<li>final_tape: Final tape with updated metadata after completion</li>
</ul>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Yields:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>AgentEvent</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.AgentStream" href="#tapeagents.agent.AgentStream">AgentStream</a>[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>]</code>
)          –
          <div class="doc-md-description">
            <p>Events indicating the agent's progress including partial steps,
completed steps with updated tape, and the final result.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If the agent generates anything other than steps or partial steps.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">,</span> <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentStream</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the agent on the tape iteratively, delegating to subagents until a stop condition is met.</span>

<span class="sd">    This method executes the agent&#39;s logic by:</span>
<span class="sd">    1. Delegating to appropriate subagents based on the tape state</span>
<span class="sd">    2. Processing steps from subagent iterations</span>
<span class="sd">    3. Updating the tape with new steps</span>
<span class="sd">    4. Checking stop conditions</span>
<span class="sd">    5. Tracking metadata about the execution</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The input tape to process</span>
<span class="sd">        max_iterations (int, optional): Maximum number of iterations to run.</span>
<span class="sd">            If None, uses self.max_iterations. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        AgentStream[TapeType]: A stream of AgentEvents containing:</span>

<span class="sd">            - partial_step: Intermediate processing steps</span>
<span class="sd">            - step: Completed agent steps with updated tape</span>
<span class="sd">            - final_tape: Final tape with updated metadata after completion</span>

<span class="sd">    Yields:</span>
<span class="sd">        AgentEvent: Events indicating the agent&#39;s progress including partial steps,</span>
<span class="sd">            completed steps with updated tape, and the final result.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the agent generates anything other than steps or partial steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max_iterations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iterations</span>

    <span class="k">def</span> <span class="nf">_run_implementation</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">tape</span>
        <span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">input_tape_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
        <span class="n">input_tape_id</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">id</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="n">n_iterations</span> <span class="o">&lt;</span> <span class="n">max_iterations</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
            <span class="n">current_subagent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delegate</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">current_subagent</span><span class="o">.</span><span class="n">run_iteration</span><span class="p">(</span><span class="n">tape</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">PartialStep</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">AgentEvent</span><span class="p">(</span><span class="n">partial_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">AgentStep</span><span class="p">):</span>
                    <span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="n">current_subagent</span><span class="o">.</span><span class="n">full_name</span>
                    <span class="n">tape</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">AgentEvent</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">partial_tape</span><span class="o">=</span><span class="n">tape</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_stop</span><span class="p">(</span><span class="n">tape</span><span class="p">):</span>
                        <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent can only generate steps or partial steps&quot;</span><span class="p">)</span>
            <span class="n">n_iterations</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">updated_metadata</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span>
            <span class="n">update</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">parent_id</span><span class="o">=</span><span class="n">input_tape_id</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">n_added_steps</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span> <span class="o">-</span> <span class="n">input_tape_length</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_tape</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">updated_metadata</span><span class="p">))</span>
        <span class="k">yield</span> <span class="n">AgentEvent</span><span class="p">(</span><span class="n">final_tape</span><span class="o">=</span><span class="n">final_tape</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">AgentStream</span><span class="p">(</span><span class="n">_run_implementation</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.run_iteration" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">run_iteration</span><span class="p">(</span><span class="n">tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Run one iteration of the agent (assuming one call to the underlyng model).</p>
<p>During an iteration the agent generates steps from a stream of tokens that arises
from a single LLM call with a single prompt. An agent can do multiple iterations
before returning the next action (see <code>run</code> method).</p>
<p>This function can also take a given <code>llm_stream</code>, which can be useful when the agent
reuses a tape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape to run the agent on</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>llm_stream</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.llms.LLMStream" href="../llms/#tapeagents.llms.LLMStream">LLMStream</a></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>The stream of tokens from the LLM</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Yields:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.core.Step" href="../core/#tapeagents.core.Step">Step</a> | <a class="autorefs autorefs-internal" title="tapeagents.core.PartialStep" href="../core/#tapeagents.core.PartialStep">PartialStep</a></code>
          –
          <div class="doc-md-description">
            <p>Union[Step, PartialStep]: The generated steps or partial</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>NotImplementedError</code>
            –
          <div class="doc-md-description">
            <p>If the agent has multiple LLMs and no LLM stream is provided</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_iteration</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">:</span> <span class="n">LLMStream</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Step</span> <span class="o">|</span> <span class="n">PartialStep</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run one iteration of the agent (assuming one call to the underlyng model).</span>

<span class="sd">    During an iteration the agent generates steps from a stream of tokens that arises</span>
<span class="sd">    from a single LLM call with a single prompt. An agent can do multiple iterations</span>
<span class="sd">    before returning the next action (see `run` method).</span>

<span class="sd">    This function can also take a given `llm_stream`, which can be useful when the agent</span>
<span class="sd">    reuses a tape.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The tape to run the agent on</span>
<span class="sd">        llm_stream (LLMStream): The stream of tokens from the LLM</span>

<span class="sd">    Yields:</span>
<span class="sd">        Union[Step, PartialStep]: The generated steps or partial</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If the agent has multiple LLMs and no LLM stream is provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">llm_stream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_prompt</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;TODO: implement LLM choice in the prompt&quot;</span><span class="p">)</span>
        <span class="n">llm_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="k">if</span> <span class="n">prompt</span> <span class="k">else</span> <span class="n">LLMStream</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_steps</span><span class="p">(</span><span class="n">tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">AgentStep</span><span class="p">):</span>
            <span class="n">step</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">prompt_id</span> <span class="o">=</span> <span class="n">llm_stream</span><span class="o">.</span><span class="n">prompt</span><span class="o">.</span><span class="n">id</span>
        <span class="k">yield</span> <span class="n">step</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.select_node" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">select_node</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Select the next node to execute based on the current state of the tape.</p>


<details class="the-selection-process-follows-these-rules" open>
  <summary>The selection process follows these rules</summary>
  <ol>
<li>If next_node is explicitly set in the tape view, return that node</li>
<li>If no nodes have been run yet (last_node is None), return the first node</li>
<li>Return the node that follows the last executed node in the list</li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape containing execution state and data</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Node</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.Node" href="#tapeagents.agent.Node">Node</a></code>
)          –
          <div class="doc-md-description">
            <p>The next node to be executed</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If unable to determine the next node to execute (e.g., reached end of list)</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select the next node to execute based on the current state of the tape.</span>

<span class="sd">    The selection process follows these rules:</span>
<span class="sd">        1. If next_node is explicitly set in the tape view, return that node</span>
<span class="sd">        2. If no nodes have been run yet (last_node is None), return the first node</span>
<span class="sd">        3. Return the node that follows the last executed node in the list</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The tape containing execution state and data</span>

<span class="sd">    Returns:</span>
<span class="sd">        Node: The next node to be executed</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If unable to determine the next node to execute (e.g., reached end of list)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Select the node to run next based on the current state of the tape.</span>
    <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_view</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span><span class="o">.</span><span class="n">top</span>
    <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">next_node</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Next node was set explicitly in the tape: </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">next_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">next_node</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">view</span><span class="o">.</span><span class="n">last_node</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: No nodes have been run yet, select node 0: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Select the next node that stored after the last node found in the tape</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Last node in view: </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">last_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Known nodes: </span><span class="si">{</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">view</span><span class="o">.</span><span class="n">last_node</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Select immediate next node: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Next node not found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.should_stop" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">should_stop</span><span class="p">(</span><span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if the agent should stop its turn and wait for observations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape containing the sequence of steps (actions and observations).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>bool</code></b> (              <code>bool</code>
)          –
          <div class="doc-md-description">
            <p>True if the last step in the tape is an Action, indicating the agent should stop and wait for observations.
 False if the last step is not an Action, indicating the agent can continue.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">should_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the agent should stop its turn and wait for observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        tape (TapeType): The tape containing the sequence of steps (actions and observations).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the last step in the tape is an Action, indicating the agent should stop and wait for observations.</span>
<span class="sd">             False if the last step is not an Action, indicating the agent can continue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Action</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Agent.update" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">agent_config</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Updates the agent's configuration while preserving instance types.</p>
<p>This method allows reconfiguration of the agent while maintaining the class types
of LLMs and subagents. It performs a deep update by recursively applying changes
to nested components.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>agent_config</code></b>
              (<code>dict[str, <span title="typing.Any">Any</span>]</code>)
          –
          <div class="doc-md-description">
            <p>New configuration dictionary containing LLMs,
subagents, templates and other agent settings.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent" href="#tapeagents.agent.Agent">Agent</a>[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>]</code>
          –
          <div class="doc-md-description">
            <p>Agent[TapeType]: A new agent instance with updated configuration.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If the new configuration has different LLMs or number of subagents
than the current agent.</p>
          </div>
        </li>
    </ul>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Only string templates are updated, complex template objects are preserved</li>
<li>Node configurations are preserved to avoid potential issues</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Agent</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the agent&#39;s configuration while preserving instance types.</span>

<span class="sd">    This method allows reconfiguration of the agent while maintaining the class types</span>
<span class="sd">    of LLMs and subagents. It performs a deep update by recursively applying changes</span>
<span class="sd">    to nested components.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent_config (dict[str, Any]): New configuration dictionary containing LLMs,</span>
<span class="sd">            subagents, templates and other agent settings.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Agent[TapeType]: A new agent instance with updated configuration.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the new configuration has different LLMs or number of subagents</span>
<span class="sd">            than the current agent.</span>

<span class="sd">    Note:</span>
<span class="sd">        - Only string templates are updated, complex template objects are preserved</span>
<span class="sd">        - Node configurations are preserved to avoid potential issues</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;llms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent has different LLMs than the new configuration.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;subagents&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent has different number of subagents than the new configuration.&quot;</span><span class="p">)</span>
    <span class="c1"># recurse into subagents</span>
    <span class="n">subagents</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">subagent</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">subagent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subagent_obj</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">subagent</span><span class="p">,</span> <span class="n">subagent_obj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subagents</span><span class="p">,</span> <span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;subagents&quot;</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="c1"># recurse into llms</span>
    <span class="n">llms</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">llm</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;llms&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">llm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">llms</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="c1"># only update templates are str</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="p">(</span><span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent_config</span><span class="p">[</span><span class="s2">&quot;templates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">config_copy</span> <span class="o">=</span> <span class="n">agent_config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;llms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">llms</span>
    <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;subagents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subagents</span>
    <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;templates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">templates</span>
    <span class="c1"># do not update nodes for now to avoid tricky bugs</span>
    <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">config_copy</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tapeagents.agent.AgentStream" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>AgentStream</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>]</code></p>


        <p>A wrapper around a generator that produces AgentEvents, representing the result of an agent run.</p>
<p>The generator can be iterated over to get the events, or the final tape can be extracted with get_final_tape.
Support iterable protocol and generator protocol.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.AgentStream.generator">generator</span></code></b>
              (<code><span title="typing.Generator">Generator</span>[<a class="autorefs autorefs-internal" title="tapeagents.core.AgentEvent" href="../core/#tapeagents.core.AgentEvent">AgentEvent</a>[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>], None, None]</code>)
          –
          <div class="doc-md-description">
            <p>The generator that produces AgentEvents.</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.AgentStream.get_final_tape" href="#tapeagents.agent.AgentStream.get_final_tape">get_final_tape</a></code></b>
            –
            <div class="doc-md-description">
              <p>Retrieve the final tape from the agent's events.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.AgentStream.get_steps" href="#tapeagents.agent.AgentStream.get_steps">get_steps</a></code></b>
            –
            <div class="doc-md-description">
              <p>Generator function that yields steps from events.</p>
            </div>
          </li>
    </ul>



              <details class="quote">
                <summary>Source code in <code>tapeagents/agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AgentStream</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper around a generator that produces AgentEvents, representing the result of an agent run.</span>

<span class="sd">    The generator can be iterated over to get the events, or the final tape can be extracted with get_final_tape.</span>
<span class="sd">    Support iterable protocol and generator protocol.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        generator (Generator[AgentEvent[TapeType], None, None]): The generator that produces AgentEvents.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">Generator</span><span class="p">[</span><span class="n">AgentEvent</span><span class="p">[</span><span class="n">TapeType</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentEvent</span><span class="p">[</span><span class="n">TapeType</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_final_tape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TapeType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the final tape from the agent&#39;s events.</span>

<span class="sd">        Iterates through the events of the agent and returns the final tape</span>
<span class="sd">        if it is found. If no final tape is produced by the agent, a ValueError</span>
<span class="sd">        is raised.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TapeType: The final tape produced by the agent.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the agent did not produce a final tape.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">final_tape</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">final_tape</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent didn&#39;t produce final tape&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Step</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generator function that yields steps from events.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Step: The step associated with each event that has a step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">step</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">event</span><span class="o">.</span><span class="n">step</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.AgentStream.get_final_tape" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_final_tape</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve the final tape from the agent's events.</p>
<p>Iterates through the events of the agent and returns the final tape
if it is found. If no final tape is produced by the agent, a ValueError
is raised.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>TapeType</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a></code>
)          –
          <div class="doc-md-description">
            <p>The final tape produced by the agent.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>ValueError</code>
            –
          <div class="doc-md-description">
            <p>If the agent did not produce a final tape.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_final_tape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TapeType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the final tape from the agent&#39;s events.</span>

<span class="sd">    Iterates through the events of the agent and returns the final tape</span>
<span class="sd">    if it is found. If no final tape is produced by the agent, a ValueError</span>
<span class="sd">    is raised.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TapeType: The final tape produced by the agent.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the agent did not produce a final tape.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">final_tape</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">final_tape</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agent didn&#39;t produce final tape&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.AgentStream.get_steps" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_steps</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generator function that yields steps from events.</p>


<p><span class="doc-section-title">Yields:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Step</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.core.Step" href="../core/#tapeagents.core.Step">Step</a></code>
)          –
          <div class="doc-md-description">
            <p>The step associated with each event that has a step.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Step</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generator function that yields steps from events.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Step: The step associated with each event that has a step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">step</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">event</span><span class="o">.</span><span class="n">step</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tapeagents.agent.Annotator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>Annotator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="tapeagents.agent.Agent" href="#tapeagents.agent.Agent">Agent</a>[<a class="autorefs autorefs-internal" title="tapeagents.core.AnnotatorTapeType" href="../core/#tapeagents.core.AnnotatorTapeType">AnnotatorTapeType</a>]</code>, <code><span title="typing.Generic">Generic</span>[<a class="autorefs autorefs-internal" title="tapeagents.core.TapeType" href="../core/#tapeagents.core.TapeType">TapeType</a>, <a class="autorefs autorefs-internal" title="tapeagents.core.AnnotatorTapeType" href="../core/#tapeagents.core.AnnotatorTapeType">AnnotatorTapeType</a>]</code></p>


        <p>Annotator is the base class for agents that produce annotations for the tape of another agent.
It annotates the tape by converting it into its own tape and then producing an annotation step appended to the converted tape.</p>










              <details class="quote">
                <summary>Source code in <code>tapeagents/agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Annotator</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="n">AnnotatorTapeType</span><span class="p">],</span> <span class="n">Generic</span><span class="p">[</span><span class="n">TapeType</span><span class="p">,</span> <span class="n">AnnotatorTapeType</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Annotator is the base class for agents that produce annotations for the tape of another agent.</span>
<span class="sd">    It annotates the tape by converting it into its own tape and then producing an annotation step appended to the converted tape.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">make_own_tape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnnotatorTapeType</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">TapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnnotatorTapeType</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_own_tape</span><span class="p">(</span><span class="n">tape</span><span class="p">))</span><span class="o">.</span><span class="n">get_final_tape</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">own_tape</span><span class="p">:</span> <span class="n">AnnotatorTapeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">own_tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">annotation</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tapeagents.agent.Node" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>Node</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>A node in the agent, atomic unit of the agent's behavior.</p>
<p>The agent chooses which node to run based on the current tape.
The node has a name and contains 2 main functions:</p>
<ul>
<li>make a prompt out of the tape</li>
<li>generate steps out of the received llm output</li>
</ul>


<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.Node.name">name</span></code></b>
              (<code>str</code>)
          –
          <div class="doc-md-description">
            <p>The name of the node. Defaults to an empty string.</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Node.generate_steps" href="#tapeagents.agent.Node.generate_steps">generate_steps</a></code></b>
            –
            <div class="doc-md-description">
              <p>Generates steps for the given agent, tape, and LLM stream.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Node.make_llm_output" href="#tapeagents.agent.Node.make_llm_output">make_llm_output</a></code></b>
            –
            <div class="doc-md-description">
              <p>Generates an LLMOutput object for a given agent and tape at a specified index.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="tapeagents.agent.Node.make_prompt" href="#tapeagents.agent.Node.make_prompt">make_prompt</a></code></b>
            –
            <div class="doc-md-description">
              <p>Creates a prompt for the given agent and tape.</p>
            </div>
          </li>
    </ul>



              <details class="quote">
                <summary>Source code in <code>tapeagents/agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A node in the agent, atomic unit of the agent&#39;s behavior.</span>

<span class="sd">    The agent chooses which node to run based on the current tape.</span>
<span class="sd">    The node has a name and contains 2 main functions:</span>

<span class="sd">    - make a prompt out of the tape</span>
<span class="sd">    - generate steps out of the received llm output</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): The name of the node. Defaults to an empty string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">model_post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__context</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># class name without type variables</span>

    <span class="k">def</span> <span class="nf">make_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">Tape</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Prompt</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a prompt for the given agent and tape.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent (Any): The agent for which the prompt is being created.</span>
<span class="sd">            tape (Tape): The tape associated with the agent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Prompt: The generated prompt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Prompt</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate_steps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">Tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">:</span> <span class="n">LLMStream</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Step</span> <span class="o">|</span> <span class="n">PartialStep</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates steps for the given agent, tape, and LLM stream.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent (Any): The agent for which steps are to be generated.</span>
<span class="sd">            tape (Tape): The tape object containing relevant data.</span>
<span class="sd">            llm_stream (LLMStream): The LLM stream to be used for generating steps.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Union[Step, PartialStep]: The generated steps or partial steps.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the method is not implemented by the subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Node must implement generate_steps&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_llm_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">Tape</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMOutput</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates an LLMOutput object for a given agent and tape at a specified index.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent (Any): The agent for which the LLMOutput is being generated.</span>
<span class="sd">            tape (Tape): The tape containing the steps.</span>
<span class="sd">            index (int): The index of the step in the tape from which to generate the output.</span>

<span class="sd">        Returns:</span>
<span class="sd">            LLMOutput: An object containing the role and content for the LLM output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LLMOutput</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Node.generate_steps" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">generate_steps</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates steps for the given agent, tape, and LLM stream.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>agent</code></b>
              (<code><span title="typing.Any">Any</span></code>)
          –
          <div class="doc-md-description">
            <p>The agent for which steps are to be generated.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.Tape" href="../core/#tapeagents.core.Tape">Tape</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape object containing relevant data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>llm_stream</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.llms.LLMStream" href="../llms/#tapeagents.llms.LLMStream">LLMStream</a></code>)
          –
          <div class="doc-md-description">
            <p>The LLM stream to be used for generating steps.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Yields:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="tapeagents.core.Step" href="../core/#tapeagents.core.Step">Step</a> | <a class="autorefs autorefs-internal" title="tapeagents.core.PartialStep" href="../core/#tapeagents.core.PartialStep">PartialStep</a></code>
          –
          <div class="doc-md-description">
            <p>Union[Step, PartialStep]: The generated steps or partial steps.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>NotImplementedError</code>
            –
          <div class="doc-md-description">
            <p>If the method is not implemented by the subclass.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_steps</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">Tape</span><span class="p">,</span> <span class="n">llm_stream</span><span class="p">:</span> <span class="n">LLMStream</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Step</span> <span class="o">|</span> <span class="n">PartialStep</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates steps for the given agent, tape, and LLM stream.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent (Any): The agent for which steps are to be generated.</span>
<span class="sd">        tape (Tape): The tape object containing relevant data.</span>
<span class="sd">        llm_stream (LLMStream): The LLM stream to be used for generating steps.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Union[Step, PartialStep]: The generated steps or partial steps.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If the method is not implemented by the subclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Node must implement generate_steps&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Node.make_llm_output" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">make_llm_output</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">tape</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates an LLMOutput object for a given agent and tape at a specified index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>agent</code></b>
              (<code><span title="typing.Any">Any</span></code>)
          –
          <div class="doc-md-description">
            <p>The agent for which the LLMOutput is being generated.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.Tape" href="../core/#tapeagents.core.Tape">Tape</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape containing the steps.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>index</code></b>
              (<code>int</code>)
          –
          <div class="doc-md-description">
            <p>The index of the step in the tape from which to generate the output.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>LLMOutput</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.core.LLMOutput" href="../core/#tapeagents.core.LLMOutput">LLMOutput</a></code>
)          –
          <div class="doc-md-description">
            <p>An object containing the role and content for the LLM output.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_llm_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">Tape</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates an LLMOutput object for a given agent and tape at a specified index.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent (Any): The agent for which the LLMOutput is being generated.</span>
<span class="sd">        tape (Tape): The tape containing the steps.</span>
<span class="sd">        index (int): The index of the step in the tape from which to generate the output.</span>

<span class="sd">    Returns:</span>
<span class="sd">        LLMOutput: An object containing the role and content for the LLM output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">LLMOutput</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">tape</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tapeagents.agent.Node.make_prompt" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">make_prompt</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">tape</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a prompt for the given agent and tape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>agent</code></b>
              (<code><span title="typing.Any">Any</span></code>)
          –
          <div class="doc-md-description">
            <p>The agent for which the prompt is being created.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.Tape" href="../core/#tapeagents.core.Tape">Tape</a></code>)
          –
          <div class="doc-md-description">
            <p>The tape associated with the agent.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Prompt</code></b> (              <code><a class="autorefs autorefs-internal" title="tapeagents.core.Prompt" href="../core/#tapeagents.core.Prompt">Prompt</a></code>
)          –
          <div class="doc-md-description">
            <p>The generated prompt.</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>tapeagents/agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">tape</span><span class="p">:</span> <span class="n">Tape</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Prompt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a prompt for the given agent and tape.</span>

<span class="sd">    Args:</span>
<span class="sd">        agent (Any): The agent for which the prompt is being created.</span>
<span class="sd">        tape (Tape): The tape associated with the agent.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Prompt: The generated prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Prompt</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="tapeagents.agent.TapeReuseFailure" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TapeReuseFailure</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>ValueError</code></p>


        <p>Exception raised when tape reuse operation fails.</p>
<p>This exception is raised when an attempt to reuse a tape encounters an error,
providing access to the succesfully reused part of the tape</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>msg</code></b>
              (<code>str</code>)
          –
          <div class="doc-md-description">
            <p>Description of why the tape reuse failed</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>partial_tape</code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.Tape" href="../core/#tapeagents.core.Tape">Tape</a></code>)
          –
          <div class="doc-md-description">
            <p>The incomplete/partial tape that was being constructed</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><span title="tapeagents.agent.TapeReuseFailure.partial_tape">partial_tape</span></code></b>
              (<code><a class="autorefs autorefs-internal" title="tapeagents.core.Tape" href="../core/#tapeagents.core.Tape">Tape</a></code>)
          –
          <div class="doc-md-description">
            <p>The incomplete tape at the point of failure</p>
          </div>
        </li>
    </ul>










              <details class="quote">
                <summary>Source code in <code>tapeagents/agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TapeReuseFailure</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception raised when tape reuse operation fails.</span>

<span class="sd">    This exception is raised when an attempt to reuse a tape encounters an error,</span>
<span class="sd">    providing access to the succesfully reused part of the tape</span>

<span class="sd">    Args:</span>
<span class="sd">        msg (str): Description of why the tape reuse failed</span>
<span class="sd">        partial_tape (Tape): The incomplete/partial tape that was being constructed</span>

<span class="sd">    Attributes:</span>
<span class="sd">        partial_tape (Tape): The incomplete tape at the point of failure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">partial_tape</span><span class="p">:</span> <span class="n">Tape</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partial_tape</span> <span class="o">=</span> <span class="n">partial_tape</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 29, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 29, 2024</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../quickstart/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Quickstart">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Quickstart
              </div>
            </div>
          </a>
        
        
          
          <a href="../batch/" class="md-footer__link md-footer__link--next" aria-label="Next: Batch">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Batch
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2024 ServiceNow, Inc.
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.path", "navigation.top", "content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>